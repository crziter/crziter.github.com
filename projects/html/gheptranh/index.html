<!DOCTYPE html>
<html>
<head>
	<title>Game xếp hình</title>
	<meta charset="utf-8" >
	
	<style type="text/css">
		#wrapper {
			width: 700px;
			margin: 0px auto;
			text-align: center;
		}
		
		#board {
			margin: 0px;
			padding: 0px;
			border-width: 1px;
			border-color: black;
			border-style: solid;
			background-color: yellow;
			float: left;
		}
		
		#control-board {
			float: left;
			margin-left: 20px;
		}
		
		#btnShuffle {
			width: 100%;
		}
		
		#btnPlay {
			width: 100%;
		}
		
		#txtTime {
			border-width: 0px;
		}
		
		#txtStep {
			border-width: 0px;
		}
	</style>
	
	<script type="text/javascript">
	function addSec(){sec++;if(sec==60){min++;sec=0}document.getElementById("txtTime").value=min+":"+sec}function Pos(e,t){this.x=e;this.y=t}function draw(){ctx.clearRect(0,0,canvas.width,canvas.height);var e=0;var t=0;for(var n=0;n<20;++n){e=(part_current[n].x+1)*box_border;t=(part_current[n].y+1)*box_border;ctx.drawImage(image,part_need[n].x*box_img_w,image.height-(part_need[n].y+1)*box_img_h,box_img_w,box_img_h,part_current[n].x*box_size+e,canvas.height-(part_current[n].y+1)*box_size-t,box_size,box_size)}e=(part_blacked.x+1)*box_border;t=(part_blacked.y+1)*box_border;ctx.fillStyle="#FF0000";ctx.fillRect(part_blacked.x*box_size+e,canvas.height-(part_blacked.y+1)*box_size-t,box_size,box_size);ctx.fillStyle="#FFFFFF";ctx.fillRect(82,0,canvas.width-82,81)}function checkForWin(){for(var e=0;e<20;++e){if(part_need[e].x!=part_current[e].x||part_need[e].y!=part_current[e].y)return false}return true}function shuffle(){var e=new Array;var t=0;for(var n=0;n<20;++n){if(n!=16){e[t]=n;t++}}t=0;for(var n=0;n<20;++n){if(n==16){part_current[16]=new Pos(part_need[16].x,part_need[16].y);continue}var r;if(e.length<=1){r=0}else{var r=Math.round(Math.random()*(e.length-1))}part_current[n]=new Pos(part_need[e[r]].x,part_need[e[r]].y);var i=new Array;var t=0;for(var s=0;s<e.length;++s){if(s!=r){i[t]=e[s];t++}}e=[];for(var s=0;s<i.length;++s){e[s]=i[s]}}}function click(e){if(!play_clicked){alert("Click Play to start game!");return}var t=0;var n=0;var r=e.clientX+document.body.scrollLeft-canvas.getBoundingClientRect().left;var i=e.clientY+document.body.scrollTop-canvas.getBoundingClientRect().top;i=canvas.height-i;for(var s=0;s<20;++s){t=(part_current[s].x+1)*box_border;n=(part_current[s].y+1)*box_border;if(part_current[s].x*box_size+t<=r&&(part_current[s].x+1)*box_size+t>=r&&part_current[s].y*box_size+n<=i&&(part_current[s].y+1)*box_size+n>=i){console.log(s+" => "+part_current[s].x+", "+part_current[s].y);if(part_current[s].x==part_blacked.x&&(part_current[s].y==part_blacked.y-1||part_current[s].y==part_blacked.y+1)||part_current[s].y==part_blacked.y&&(part_current[s].x==part_blacked.x-1||part_current[s].x==part_blacked.x+1)){var o=new Pos(part_blacked.x,part_blacked.y);part_blacked.x=part_current[s].x;part_blacked.y=part_current[s].y;part_current[s].x=o.x;part_current[s].y=o.y;draw();if(checkForWin()){alert("You win!");if(add_sec_itv>0){clearInterval(add_sec_itv);add_sec_itv=0}}}}}step++;document.getElementById("txtStep").value=step}function init(){canvas=document.getElementById("board");ctx=canvas.getContext("2d");image.src="./pic.jpg";image.onload=function(){box_img_w=image.width/game_x;box_img_h=image.height/game_y;draw()};for(var e=0;e<game_y;++e){for(var t=0;t<game_x;++t){part_need[e*game_x+t]=new Pos(t,e)}}shuffle();canvas.addEventListener("click",click,false);document.getElementById("btnShuffle").onclick=function(){shuffle();draw()};document.getElementById("btnPlay").onclick=function(){document.getElementById("btnShuffle").disabled=true;add_sec_itv=setInterval(function(){addSec()},1e3);play_clicked=true}}var box_size=80;var box_border=1;var game_x=4;var game_y=5;var box_img_w;var box_img_h;var image=new Image;var part_need=new Array;var part_current=new Array;var part_blacked=new Pos(0,5);var game_id;var canvas;var ctx;var add_sec_itv=0;var play_clicked=false;var step=0;var min=0;var sec=0
	</script>
</head>
<body onload="init();">
<div id="wrapper">
	<canvas id="board" width="325px" height="487px"></canvas>
	<div id="control-board">
		<div><input id="btnShuffle" type="button" value="Shuffle" /></div>
		<div><input id="btnPlay" type="button" value="Play" /> </div>
		<div><span>Time: </span><input id="txtTime" value="--:--" /></div>
		<div><span>Step: </span><input id="txtStep" value="0" /></div>
		<div>Result:</div>
		<img src="./pic.jpg" width="200px" />
	</div>
</div>
</body>
</html>
